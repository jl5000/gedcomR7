---
title: "Implementation of gedcomS7"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(gedcomS7)
```

## Why gedcomS7?

One of the main characteristics I wanted for this package was to hide the complexity of the GEDCOM specification, and try to automate genealogical tasks that are time consuming to do manually.

I spent a significant amount of time before writing any code considering my options for how the data would be stored under the hood. In one blog I considered storing genealogical data in a relational table format as it is easier to deal with, but discounted it very quickly as it is not well suited to nested data (list columns are not ideal for this application).

I toyed with the idea of using an off-the-shelf open source product like [GRAMPS](https://gramps-project.org) but I found it awkward to use and wanted something where I was in complete control, taking full advantage of the strengths of R.

I also considered using data structures more suited to this type of data, such as JSON or graphs (using the `igraph` or `data.tree` package). However, I discovered it would be quite difficult representing some of the structures in the GEDCOM specification to my satisfaction.

My preference was for an Object Orientated approach, which is what many other applications use, but none of the OOP solutions in R quite fit the bill.

My first serious attempt at doing this resulted in `tidyged` and the other packages of the `gedcompendium`. This adopted a dataframe and `tidyverse` approach and whilst it did work it was dependency-heavy and required a lot of processing under the hood.

The release of `S7` presented an ideal opportunity to revisit creating an OOP-based GEDCOM package in R. Initial testing had promising results and so I continued building out the rest of the package, using the updated GEDCOM 7.0 specification.

## The gedcomS7 object

The main GEDCOM object is an S7 representation of a GEDCOM file:

```{r}
ged <- read_gedcom("https://gedcom.io/testfiles/gedcom70/remarriage1.ged")

str(ged)
```

Properties of the GEDCOM object can be accessed and modified using the `@` operator, e.g.

```{r}
ged@default_language
ged@default_language <- "en"
```

The properties of the main GEDCOM object are either:

* Properties of the header (metadata about the file as a whole);
* Lists of records of each type;
* 'Helper' properties that give important summaries;
* Properties that allow the user the control how the GEDCOM object behaves.


Many GEDCOM processors modify the data on import, perhaps ignoring custom tags. This package reads the file as-is, and the only modification of the file is in line with that recommended in the GEDCOM 5.5.5 specification, specifically; replacing double '@' symbols with single ones, merging CONC/CONT lines, and ensuring appropriate capitalisation of certain values. In general, the package sticks rigidly to the GEDCOM specification and does not use custom tags. There is a real issue with other desktop applications creating their own flavours of file and diverging from the specification; `tidyged` does not and will never do this.

If you want to modify single values in a GEDCOM or do a simple Find/Replace, then this is straightforward to achieve with a simple text editor.

<p style="text-align: right;"><a href="https://jl5000.github.io/tidyged/articles/gedcompendium.html">Next article: The gedcompendium ></a></p>







